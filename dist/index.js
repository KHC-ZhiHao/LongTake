"use strict";var _toConsumableArray2=require("babel-runtime/helpers/toConsumableArray"),_toConsumableArray3=_interopRequireDefault(_toConsumableArray2),_regenerator=require("babel-runtime/regenerator"),_regenerator2=_interopRequireDefault(_regenerator),_asyncToGenerator2=require("babel-runtime/helpers/asyncToGenerator"),_asyncToGenerator3=_interopRequireDefault(_asyncToGenerator2),_getPrototypeOf=require("babel-runtime/core-js/object/get-prototype-of"),_getPrototypeOf2=_interopRequireDefault(_getPrototypeOf),_possibleConstructorReturn2=require("babel-runtime/helpers/possibleConstructorReturn"),_possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2),_inherits2=require("babel-runtime/helpers/inherits"),_inherits3=_interopRequireDefault(_inherits2),_classCallCheck2=require("babel-runtime/helpers/classCallCheck"),_classCallCheck3=_interopRequireDefault(_classCallCheck2),_createClass2=require("babel-runtime/helpers/createClass"),_createClass3=_interopRequireDefault(_createClass2),_typeof2=require("babel-runtime/helpers/typeof"),_typeof3=_interopRequireDefault(_typeof2);function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}!function(e,t){"undefined"!=typeof module&&"object"===("undefined"==typeof exports?"undefined":(0,_typeof3.default)(exports))?module.exports=t():"function"==typeof define&&(define.amd||define.cmd)?define(function(){return t}):e.LongTake=t()}("undefined"!=typeof window?window:global,function(){var e=function(){function t(e){(0,_classCallCheck3.default)(this,t),this.moduleBase={name:e||"No module base name.",worker:{}}}return(0,_createClass3.default)(t,[{key:"each",value:function(e,t){if("object"===(void 0===e?"undefined":(0,_typeof3.default)(e)))if(Array.isArray(e))for(var i=e.length,n=0;n<i;n++){if("_break"===t(e[n],n))break}else for(var a in e){if("_break"===t(e[a],a))break}else this.systemError("each","Not a object or array.",e)}},{key:"reverseEach",value:function(e,t){if(Array.isArray(e))for(var i=e.length;0<=i;i--){var n=t(e[i],i);if("_break"===n)break}else this.systemError("each","Not a array.",e)}},{key:"runWhile",value:function(e){for(var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1e4,i=0;;){var n=e(i);if("_break"===n)break;if("_continue"!==n){if(t<i)break;i++}}}},{key:"systemError",value:function(e,t,i){throw i&&(console.log("%c error object is : ","color:#FFF; background:red"),console.log(i)),new Error("(☉д⊙)!! "+this.moduleBase.name+" => "+e+" -> "+t)}}]),t}(),a=new(function(){function e(){(0,_classCallCheck3.default)(this,e),this.arc=Math.PI/180}return(0,_createClass3.default)(e,[{key:"sinByDeg",value:function(e){return Math.sin(e%360*this.arc)}},{key:"cosByDeg",value:function(e){return Math.cos(e%360*this.arc)}}]),e}()),t=function(e){function t(){(0,_classCallCheck3.default)(this,t);var e=(0,_possibleConstructorReturn3.default)(this,(t.__proto__||(0,_getPrototypeOf2.default)(t)).call(this,"Loader"));return e.data={},e.files={},e.fileLength=0,e.completed=0,e}return(0,_inherits3.default)(t,e),(0,_createClass3.default)(t,[{key:"onload",value:function(e){var t=this;this.completed>=this.fileLength?e():setTimeout(function(){t.onload(e)},100)}},{key:"start",value:function(e){var t=this;for(var i in this.files)this.data[i]=new Image,this.data[i].onload=function(){t.completed+=1,"function"==typeof e&&e(t.completed,t.fileLength),t.completed===t.fileLength&&(delete t.files,delete t.types)},this.data[i].src=this.files[i]}},{key:"add",value:function(e,t){null==this.files[e]?(this.fileLength+=1,this.files[e]=this.validateFile(t)):this.systemError("add","Name conflict.",e)}},{key:"validateFile",value:function(e){var t=e.split(".").pop();return-1!==["png","jpg"].indexOf(t)||"data:"===e.slice(0,5)?e:e instanceof Element&&e.tagName("CANVAS")?canvas.toDataURL("image/png"):void this.systemError("validateFile","File type not allowed( png, jpg, canvas element, base64url ).",e)}},{key:"get",value:function(e){if(this.data[e])return this.data[e];this.systemError("get","Data not found.",e)}}]),t}(e),i=function(){function e(){(0,_classCallCheck3.default)(this,e)}return(0,_createClass3.default)(e,null,[{key:"linear",value:function(e,t){return e/t}},{key:"easeInQuad",value:function(e,t){return 1*(e/=t)*e+0}},{key:"easeOutQuad",value:function(e,t){return-1*(e/=t)*(e-2)}},{key:"easeInOutQuad",value:function(e,t){return(e/=t/2)<1?.5*e*e:-.5*(--e*(e-2)-1)}},{key:"easeInCubic",value:function(e,t){return 1*(e/=t)*e*e}},{key:"easeOutCubic",value:function(e,t){return 1*((e=e/t-1)*e*e+1)}},{key:"easeInOutCubic",value:function(e,t){return(e/=t/2)<1?.5*e*e*e:.5*((e-=2)*e*e+2)}},{key:"easeInQuart",value:function(e,t){return 1*(e/=t)*e*e*e}},{key:"easeOutQuart",value:function(e,t){return-1*((e=e/t-1)*e*e*e-1)}},{key:"easeInOutQuart",value:function(e,t){return(e/=t/2)<1?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2)}},{key:"easeInQuint",value:function(e,t){return 1*(e/=t)*e*e*e*e}},{key:"easeOutQuint",value:function(e,t){return 1*((e=e/t-1)*e*e*e*e+1)}},{key:"easeInOutQuint",value:function(e,t){return(e/=t/2)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2)+0}},{key:"easeInSine",value:function(e,t){return-1*Math.cos(e/t*(Math.PI/2))+1}},{key:"easeOutSine",value:function(e,t){return 1*Math.sin(e/t*(Math.PI/2))}},{key:"easeInOutSine",value:function(e,t){return-.5*(Math.cos(Math.PI*e/t)-1)}},{key:"easeInExpo",value:function(e,t){return 0==e?0:1*Math.pow(2,10*(e/t-1))}},{key:"easeOutExpo",value:function(e,t){return e==t?1:1*(1-Math.pow(2,-10*e/t))}},{key:"easeInOutExpo",value:function(e,t){return 0==e?0:e==t?1:(e/=t/2)<1?.5*Math.pow(2,10*(e-1)):.5*(2-Math.pow(2,-10*--e))}},{key:"easeInCirc",value:function(e,t){return-1*(Math.sqrt(1-(e/=t)*e)-1)}},{key:"easeOutCirc",value:function(e,t){return 1*Math.sqrt(1-(e=e/t-1)*e)}},{key:"easeInOutCirc",value:function(e,t){return(e/=t/2)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)}},{key:"easeInElastic",value:function(e,t){var i=1.70158,n=0,a=1;if(0==e)return 0;if(1==(e/=t))return 1;if(n||(n=.3*t),a<1){a=1;i=n/4}else i=n/(2*Math.PI)*Math.asin(1/a);return-a*Math.pow(2,10*(e-=1))*Math.sin((e*t-i)*(2*Math.PI)/n)+0}},{key:"easeOutElastic",value:function(e,t){var i=1.70158,n=0,a=1;if(0==e)return 0;if(1==(e/=t))return 1;if(n||(n=.3*t),a<1){a=1;i=n/4}else i=n/(2*Math.PI)*Math.asin(1/a);return a*Math.pow(2,-10*e)*Math.sin((e*t-i)*(2*Math.PI)/n)+1}},{key:"easeInOutElastic",value:function(e,t){var i=1.70158,n=0,a=1;if(0==e)return 0;if(2==(e/=t/2))return 1;if(n||(n=t*(.3*1.5)),a<1){a=1;i=n/4}return e<1?a*Math.pow(2,10*(e-=1))*Math.sin((e*t-i)*(2*Math.PI)/n)*-.5:a*Math.pow(2,-10*(e-=1))*Math.sin((e*t-i)*(2*Math.PI)/n)*.5+1}},{key:"easeInBack",value:function(e,t){return 1*(e/=t)*e*(2.70158*e-1.70158)}},{key:"easeOutBack",value:function(e,t){return 1*((e=e/t-1)*e*(2.70158*e+1.70158)+1)}},{key:"easeInOutBack",value:function(e,t){var i=1.70158;return(e/=t/2)<1?e*e*((1+(i*=1.525))*e-i)*.5:.5*((e-=2)*e*((1+(i*=1.525))*e+i)+2)}},{key:"easeInBounce",value:function(e,t){return 1-this.easeOutBounce(t-e,t)}},{key:"easeOutBounce",value:function(e,t){return(e/=t)<1/2.75?7.5625*e*e*1:e<2/2.75?1*(7.5625*(e-=1.5/2.75)*e+.75)+0:e<2.5/2.75?1*(7.5625*(e-=2.25/2.75)*e+.9375)+0:1*(7.5625*(e-=2.625/2.75)*e+.984375)}},{key:"easeInOutBounce",value:function(e,t){return e<t/2?.5*this.easeInBounce(2*e,t):.5*this.easeOutBounce(2*e-t,t)+.5}}]),e}(),n=function(e){function a(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:100,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:100,i=arguments[2];(0,_classCallCheck3.default)(this,a);var n=(0,_possibleConstructorReturn3.default)(this,(a.__proto__||(0,_getPrototypeOf2.default)(a)).call(this,"Bitmap"));return n.canvas=i||document.createElement("canvas"),n.context=n.canvas.getContext("2d"),n.transform=!0,n.cache=!1,n.imgData=null,(n.image=null)==i&&n.resize(e,t),n}return(0,_inherits3.default)(a,e),(0,_createClass3.default)(a,[{key:"getRenderTarget",value:function(){var e=this;if(this.image)return this.image;if(0==this.cache)return this.canvas;var t=new Image;return t.onload=function(){e.image=t},t.src=this.canvas.toDataURL(),this.canvas}},{key:"render",value:function(e){var t=this;this.transform&&(this.context.save(),this.drawTransform(e)),this.draw(e.bitmap,e.screenX,e.screenY),e.eachChildren(function(e){t.render(e)}),this.transform&&this.context.restore()}},{key:"drawTransform",value:function(e){var t=e.posX,i=e.posY,n=this.context;n.translate(t,i),e.mask&&(e.mask(),e.context.clip()),255!==e.opacity&&(n.globalAlpha=e.opacity/255),e.blendMode&&(n.globalCompositeOperation=e.blendMode),0!==e.rotation&&n.rotate(e.rotation*e.main.math.arc),1===e.scaleHeight&&1===e.scaleWidth||n.scale(e.scaleWidth,e.scaleHeight),0===e.skewX&&0===e.skewY||n.transform(1,e.skewX,e.skewY,1,0,0),n.translate(-t,-i)}},{key:"resize",value:function(e,t){this.width=e||this.width,this.height=t||this.height}},{key:"clear",value:function(){this.context.clearRect(0,0,this.width,this.height)}},{key:"draw",value:function(e,t,i){this.context.drawImage(e.getRenderTarget(),Math.floor(t),Math.floor(i))}},{key:"clearCache",value:function(){this.imgData=null,this.image=null}},{key:"getPixel",value:function(e,t){var i=this.getImageData(),n=e*(4*i.width)+4*t;return[i.data[n],i.data[n+1],i.data[n+2],i.data[n+3]]}},{key:"getImageData",value:function(){return null==this.imgData&&(this.imgData=this.context.getImageData(0,0,this.width,this.height)),this.imgData}},{key:"putImageData",value:function(e){this.clear(),this.context.putImageData(e,0,0)}},{key:"width",get:function(){return this.canvas.width},set:function(e){this.canvas.width=e}},{key:"height",get:function(){return this.canvas.height},set:function(e){this.canvas.height=e}}],[{key:"isBitmap",value:function(e){return e instanceof this}}]),a}(e),r=function(e){function a(e,t,i){(0,_classCallCheck3.default)(this,a);var n=(0,_possibleConstructorReturn3.default)(this,(a.__proto__||(0,_getPrototypeOf2.default)(a)).call(this,"Main"));return n.width=t,n.height=i,n.ticker=0,n.target=e,n.targetRect=n.target.getBoundingClientRect(),n.framePerSecond=60,n.stopOfAboveWindow=!0,n.baseFps=0,n.asyncRefresh=!1,n.initBitmap(),n.initCamera(),n.initStage(),n.initEvent(),window.requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)},n.update(),n}var t;return(0,_inherits3.default)(a,e),(0,_createClass3.default)(a,[{key:"initBitmap",value:function(){this.target instanceof Element&&"CANVAS"===this.target.tagName?(this.bitmap=this.target.getContext("2d"),this.bitmap.globalCompositeOperation="copy",this.buffer=new n(this.width,this.height)):this.systemError("initBitmap","Object not a cavnas.",this.target)}},{key:"register",value:function(e){var t=this;this.each(e.event,function(e){null==t.event[e.event]&&t.addEvent(e.event)})}},{key:"setFPS",value:function(e){"number"==typeof e&&0<e&&e<=60?this.framePerSecond=e:this.systemError("setFPS","FPS must between 1 to 60.",e)}},{key:"getVisibility",value:function(e){var t=document.body.clientWidth;return t<600?"xs"===e:600<=t&&t<960?-1!==["sm","xs"].indexOf(e):960<=t&&t<1264?-1!==["sm","xs","md"].indexOf(e):1264<=t&&t<1904?-1!==["sm","xs","md","lg"].indexOf(e):1904<=t&&-1!==["sm","xs","md","lg","xl"].indexOf(e)}},{key:"getEasing",value:function(e){if(i[e]&&"constructor"!==e)return i[e];this.systemError("getEasing","Name not found.",e)}},{key:"initCamera",value:function(){this.camera={sprite:null,offsetX:0,offsetY:0}}},{key:"follow",value:function(e){h.isSprite(e)?this.camera.sprite=e:this.systemError("follow","Object not a sprite",e)}},{key:"unFollow",value:function(){this.camera.sprite=null,this.camera.offsetX=0,this.camera.offsetY=0}},{key:"updateCamera",value:function(){if(this.camera.sprite&&this.camera.sprite.main){var e=this.camera.sprite,t=e.screenX+e.width*e.anchorX,i=e.screenY+e.height*e.anchorY;this.camera.offsetX=this.updateCameraOfSide(t,this.targetRect.width,this.width),this.camera.offsetY=this.updateCameraOfSide(i,this.targetRect.height,this.height)}}},{key:"updateCameraOfSide",value:function(e,t,i){var n=t/2;return e<n?0:i-n<e?0-i+t:0-e+n}},{key:"initEvent",value:function(){this.event={},this.eventAction={},this.pointerX=0,this.pointerY=0,this.addEvent("resize",this.targetResize),this.addEvent("pointermove",this.pointerMove),this.targetResize()}},{key:"addEvent",value:function(t,i){var n=this;null==this.event[t]&&(this.event[t]=function(e){null==n.eventAction[t]&&(n.eventAction[t]=e,i&&i.bind(n)(e))},this.target.addEventListener(t,this.event[t]))}},{key:"pointerMove",value:function(e){this.pointerX=(e.offsetX-this.camera.offsetX*this.targetRect.width/this.target.width)*this.target.width/this.targetRect.width,this.pointerY=(e.offsetY-this.camera.offsetY*this.targetRect.height/this.target.height)*this.target.height/this.targetRect.height}},{key:"targetResize",value:function(){this.targetRect=this.target.getBoundingClientRect()}},{key:"initStage",value:function(){this.stage=new h("Stage"),this.stage.install(this),this.stage.resize(this.width,this.height)}},{key:"update",value:function(){var e=this;this.baseFps+=this.framePerSecond,(!1===this.stopOfAboveWindow||window.pageYOffset<this.target.offsetTop+this.targetRect.height||window.pageYOffset+document.body.scrollHeight>this.target.offsetTop)&&(this.stageUpdate(),60<=this.baseFps&&!1===this.asyncRefresh&&(this.asyncRefresh=!0,this.bitmapUpdate(),this.baseFps=this.baseFps%60),this.eventAction={}),this.ticker=window.requestAnimationFrame(function(){e.update()})}},{key:"stageUpdate",value:function(){this.buffer.clear(),this.stage.mainEvent(),this.stage.mainUpdate(this.ticker+1)}},{key:"bitmapUpdate",value:(t=(0,_asyncToGenerator3.default)(_regenerator2.default.mark(function e(){return _regenerator2.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.camera.sprite&&this.updateCamera(),this.stage.mainRender(),this.buffer.render(this.stage),this.bitmap.drawImage(this.buffer.canvas,this.camera.offsetX,this.camera.offsetY),this.asyncRefresh=!1;case 5:case"end":return e.stop()}},e,this)})),function(){return t.apply(this,arguments)})}]),a}(e),s=function(e){function o(e,t,i,n,a,r){(0,_classCallCheck3.default)(this,o);var s=(0,_possibleConstructorReturn3.default)(this,(o.__proto__||(0,_getPrototypeOf2.default)(o)).call(this,"Animate"));return s.sprite=e,s.checkSprite(),s.validate({time:[t,0],duration:[i,0],easing:[n,"linear"],alternate:[a,!1],action:[r,function(){}]}),s.over=!1,s.reverse=!1,s.actionEasing=s.sprite.main.getEasing(s.easing),s.pace=1e3/s.sprite.main.framePerSecond,s}return(0,_inherits3.default)(o,e),(0,_createClass3.default)(o,[{key:"checkSprite",value:function(){h.isSprite(this.sprite)?null==this.sprite.main&&this.systemError("checkSprite","Sprite not install. Call Animate in the create please.",this.sprite):this.systemError("checkSprite","Sprite not a Sprite module",this.sprite)}},{key:"validate",value:function(e){for(var t in e){var i=e[t][0],n=e[t][1];i?(void 0===i?"undefined":(0,_typeof3.default)(i))===(void 0===n?"undefined":(0,_typeof3.default)(n))?this[t]=i:this.systemError("validated","Type error",i):this[t]=n}}},{key:"move",value:function(){if(!1!==this.over)return 1;var e=this.actionEasing(this.time+=this.reverse?-this.pace:this.pace,this.duration);return this.action(e),this.alternate?this.time>=this.duration?this.reverse=!0:this.reverse&&this.time<=0&&(this.reverse=!1):this.time>=this.duration&&(this.over=!0),e}},{key:"restart",value:function(){this.time=0,this.over=!1}}]),o}(e),h=function(e){function i(e){(0,_classCallCheck3.default)(this,i);var t=(0,_possibleConstructorReturn3.default)(this,(i.__proto__||(0,_getPrototypeOf2.default)(i)).call(this,e||"Sprite"));return t.name=e||"No name",t.main=null,t.initEvent(),t.initRender(),t.initStatus(),t.initBitmap(),t.initFamily(),t.initPosition(),t.initContainer(),t}return(0,_inherits3.default)(i,e),(0,_createClass3.default)(i,[{key:"eachChildren",value:function(e){for(var t=this.children.length,i=0;i<t;i++)e(this.children[i])}},{key:"eachChildrenDeep",value:function(i){!function t(e){e.eachChildren(function(e){i(e),t(e)})}(this)}},{key:"super",value:function(e){var t;this.__proto__[e]?(t=this.__proto__[e]).call.apply(t,[this].concat((0,_toConsumableArray3.default)([].concat(Array.prototype.slice.call(arguments)).slice(1)))):this.systemError("super","Prototype not found.",e)}},{key:"install",value:function(e){this.main=e,this.main.register(this),this.create()}},{key:"create",value:function(){}},{key:"initBitmap",value:function(){var e=this.parent||{};this.bitmap=new n(e.width||100,e.height||100),this.context=this.bitmap.context}},{key:"resize",value:function(e,t){"object"===(void 0===e?"undefined":(0,_typeof3.default)(e))?e.width&&e.height?this.bitmap.resize(e.width,e.height):this.systemError("resize","Object must have width and height.",e):this.bitmap.resize(e,t)}},{key:"initFamily",value:function(){this.parent=null,this.children=[]}},{key:"addChildren",value:function(e){i.isSprite(e)?null==e.parent?((e.parent=this).children.push(e),this.sortChildren()):this.systemError("addChildren","Sprite have parent.",e):this.systemError("addChildren","Object not a sprite",e)}},{key:"sortChildren",value:function(){var t=[],i=[];this.eachChildren(function(e){null==i[e.z]&&(i[e.z]=[]),i[e.z].push(e)}),this.each(i,function(e){Array.isArray(e)&&(t=t.concat(e))}),this.children=t}},{key:"initEvent",value:function(){this.event={}}},{key:"on",value:function(e,t,i){null==this.event[e]?(this.main&&this.main.addEvent(t),this.event[e]={event:t,callback:i}):this.systemError("on","Event name("+e+") conflict.")}},{key:"unon",value:function(e){this.event[e]=null}},{key:"mainEvent",value:function(){var e=this;null==this.main&&this.install(this.parent.main),this.each(this.main.eventAction,function(t,i){e.each(e.event,function(e){e.event===i&&e.callback(t)})}),this.eachChildren(function(e){e.mainEvent()})}},{key:"initContainer",value:function(){this.container={skewX:0,skewY:0,scaleWidth:1,scaleHeight:1,rotation:0,opacity:255,blendMode:null}}},{key:"scale",value:function(e,t){this.scaleWidth=e,this.scaleHeight=t||e}},{key:"initPosition",value:function(){this.position={x:0,y:0,z:0,anchorX:0,anchorY:0}}},{key:"setAnchor",value:function(e,t){this.anchorX=e,this.anchorY=t||e}},{key:"initStatus",value:function(){this.status={sort:!1,cache:!1,remove:!1,hidden:!1,readSize:null}}},{key:"cache",value:function(){this.status.cache=!0,this.bitmap.cache=!0}},{key:"unCache",value:function(){this.status.cache=!1,this.bitmap.cache=!1}},{key:"hidden",value:function(e){this.status.hidden=!e||!!e}},{key:"unHidden",value:function(){this.status.hidden=!1}},{key:"getRealSize",value:function(){if(null==this.status.readSize){var e=this.width+this.skewY*this.height,t=this.height+this.skewX*this.width,i=Math.abs(a.sinByDeg(this.rotation)),n=Math.abs(a.cosByDeg(this.rotation));this.status.readSize={width:(e*n+t*i)*this.scaleWidth,height:(t*n+e*i)*this.scaleHeight}}return this.status.readSize}},{key:"getOffscreen",value:function(){if(this.main){var e=this.getRealSize();if(this.screenX<=this.main.camera.offsetX+this.main.bitmap.width&&this.screenY<=this.main.camera.offsetY+this.main.bitmap.height&&this.screenX+e.width>=this.main.camera.offsetX&&this.screenY+e.height>=this.main.camera.offsetY)return!1}return!0}},{key:"update",value:function(){}},{key:"mainUpdate",value:function(t){this.status.readSize=null;var i=!1;this.status.sort&&(this.status.sort=!1,this.sortChildren()),this.update(t),this.eachChildren(function(e){0==e.status.remove?e.mainUpdate(t):i=!0}),i&&(this.children=this.children.filter(function(e){return e.status.remove&&(e.id=-1,e.parent=null),!e.status.remove}))}},{key:"remove",value:function(){this.status.remove=!0}},{key:"removeChild",value:function(e){i.isSprite(e)?e.parent===this?e.remove():this.systemError("removeChild","Have'n this sprite",e):this.systemError("removeChild","Not a sprite",e)}},{key:"clearChildren",value:function(){var t=this;this.eachChildren(function(e){t.removeChild(e)})}},{key:"removeChildrenByName",value:function(t){var i=this;this.eachChildren(function(e){e.name===t&&i.removeChild(e)})}},{key:"removeChildrenByIndex",value:function(e){"number"==typeof e&&this.children[e]&&this.children[e].remove()}},{key:"initRender",value:function(){this.mask=null,this.filter}},{key:"render",value:function(){}},{key:"mainRender",value:function(e){this.eachChildren(function(e){e.mainRender()}),(this.canRender||e)&&(this.context.save(),this.render(this),this.context.restore(),this.renderFilter(this.filter),this.context.restore(),this.bitmap.clearCache())}},{key:"renderFilter",value:function(t){if(t){var e=this.bitmap.getImageData();t(e),this.bitmap.putImageData(e),this.eachChildren(function(e){e.renderFilter(t)})}}},{key:"drawImage",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,n=this.main.getImageByName(e);this.context.drawImage(n,t,i)}},{key:"resizeFromImage",value:function(e){var t=this.main.getImageByName(e);this.resize(t.width,t.height)}},{key:"resizeMax",value:function(){this.main?this.resize(this.main.width,this.main.height):this.systemError("resizeMax","Function call must in the create or update.")}},{key:"inRect",value:function(e,t){var i=this.getRealSize();return e>=this.screenX&&e<=this.screenX+i.width&&t>=this.screenY&&t<=this.screenY+i.height}},{key:"width",get:function(){return this.bitmap.width}},{key:"height",get:function(){return this.bitmap.height}},{key:"scaleWidth",get:function(){return this.container.scaleWidth},set:function(e){this.container.scaleWidth=e}},{key:"scaleHeight",get:function(){return this.container.scaleHeight},set:function(e){this.container.scaleHeight=e}},{key:"rotation",get:function(){return this.container.rotation},set:function(e){this.container.rotation=e%360}},{key:"blendMode",get:function(){return this.container.blendMode},set:function(e){this.container.blendMode=e}},{key:"opacity",get:function(){return this.container.opacity},set:function(e){e<=0&&(e=0),255<=e&&(e=255),this.container.opacity=e}},{key:"skewX",get:function(){return this.container.skewX},set:function(e){this.container.skewX=e}},{key:"skewY",get:function(){return this.container.skewY},set:function(e){this.container.skewY=e}},{key:"transform",get:function(){return this.bitmap.transform},set:function(e){this.bitmap.transform=!!e}},{key:"x",get:function(){return this.position.x},set:function(e){"number"==typeof e&&(this.position.x=e||0)}},{key:"y",get:function(){return this.position.y},set:function(e){"number"==typeof e&&(this.position.y=e||0)}},{key:"z",get:function(){return this.position.z},set:function(e){"number"==typeof e&&(this.position.z=e,this.parent&&(this.parent.status.sort=!0))}},{key:"screenX",get:function(){return(this.parent?this.parent.screenX+this.parent.width*this.parent.anchorX:0)+this.x-this.width*this.anchorX}},{key:"screenY",get:function(){return(this.parent?this.parent.screenY+this.parent.height*this.parent.anchorY:0)+this.y-this.height*this.anchorY}},{key:"posX",get:function(){return this.screenX+this.width*this.anchorX}},{key:"posY",get:function(){return this.screenY+this.height*this.anchorY}},{key:"anchorX",get:function(){return this.position.anchorX},set:function(e){this.position.anchorX=e}},{key:"anchorY",get:function(){return this.position.anchorY},set:function(e){this.position.anchorY=e}},{key:"canRender",get:function(){return!this.status.cache}},{key:"canShow",get:function(){return!this.status.hidden&&!this.getOffscreen()}}],[{key:"isSprite",value:function(e){return e instanceof this}}]),i}(e),o=r;return o.Sprite=h,o.Bitmap=n,o.Loader=t,o.Animate=s,o});