"use strict";function _toConsumableArray(t){return _arrayWithoutHoles(t)||_iterableToArray(t)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}function _arrayWithoutHoles(t){if(Array.isArray(t)){for(var e=0,i=new Array(t.length);e<t.length;e++)i[e]=t[e];return i}}function _instanceof(t,e){return null!=e&&"undefined"!=typeof Symbol&&e[Symbol.hasInstance]?!!e[Symbol.hasInstance](t):t instanceof e}function _possibleConstructorReturn(t,e){return!e||"object"!==_typeof(e)&&"function"!=typeof e?_assertThisInitialized(t):e}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function _classCallCheck(t,e){if(!_instanceof(t,e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function _createClass(t,e,i){return e&&_defineProperties(t.prototype,e),i&&_defineProperties(t,i),t}function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}!function(t,e){"undefined"!=typeof module&&"object"===("undefined"==typeof exports?"undefined":_typeof(exports))?module.exports=e():"function"==typeof define&&(define.amd||define.cmd)?define(function(){return e}):t.LongTake=e()}("undefined"!=typeof window?window:global,function(){var t=function(){function t(e){_classCallCheck(this,t),this.moduleBase={name:e||"No module base name."}}return _createClass(t,[{key:"each",value:function(t,e){if("object"===_typeof(t))if(Array.isArray(t))for(var i=t.length,n=0;n<i;n++){if("_break"===e(t[n],n))break}else for(var a in t){if("_break"===e(t[a],a))break}else this.systemError("each","Not a object or array.",t)}},{key:"systemError",value:function(t,e,i){throw i&&(console.log("%c error object is : ","color:#FFF; background:red"),console.log(i)),new Error("(☉д⊙)!! ".concat(this.moduleBase.name," => ").concat(t," -> ").concat(e))}}]),t}(),e=new(function(){function t(){_classCallCheck(this,t),this.arc=Math.PI/180,this.rarc=180/Math.PI,this.trigonometric={};for(var e=-360;e<360;e++)this.trigonometric[e]={},this.trigonometric[e].sin=Math.sin(e*this.arc),this.trigonometric[e].cos=Math.cos(e*this.arc)}return _createClass(t,[{key:"sinByRad",value:function(t){return this.trigonometric[Math.round(t)]?this.trigonometric[Math.round(t)].sin:Math.sin(t*this.arc)}},{key:"cosByRad",value:function(t){return this.trigonometric[Math.round(t)]?this.trigonometric[Math.round(t)].cos:Math.cos(t*this.arc)}},{key:"getVector",value:function(t,e){return{x:e*this.cosByRad(t),y:e*this.sinByRad(t)}}},{key:"randInt",value:function(t,e){return Math.floor(Math.random()*(e-t+1)+t)}},{key:"getAngle",value:function(t,e,i,n){if(t==i&&e==n)return 0;var a=Math.atan2(n-e,i-t)*this.rarc;return a>0?a:360+a}},{key:"getVisibility",value:function(t){var e=document.body.clientWidth;return e<600?"xs"===t:e>=600&&e<960?-1!==["sm","xs"].indexOf(t):e>=960&&e<1264?-1!==["sm","xs","md"].indexOf(t):e>=1264&&e<1904?-1!==["sm","xs","md","lg"].indexOf(t):e>=1904&&-1!==["sm","xs","md","lg","xl"].indexOf(t)}}]),t}()),i=function(e){function i(){var t;return _classCallCheck(this,i),(t=_possibleConstructorReturn(this,_getPrototypeOf(i).call(this,"Loader"))).data={},t.files={},t.fileLength=0,t.completed=0,t}return _inherits(i,t),_createClass(i,[{key:"onload",value:function(t){var e=this;this.completed>=this.fileLength?t():setTimeout(function(){e.onload(t)},100)}},{key:"start",value:function(t){var e=this,i=function(i){var n=new Image;n.onload=function(){window.createImageBitmap?window.createImageBitmap(n).then(function(t){e.data[i]=t}):e.data[i]=n,e.completed+=1,"function"==typeof t&&t(e.completed,e.fileLength),e.completed===e.fileLength&&(delete e.files,delete e.types)},n.src=e.files[i]};for(var n in this.files)i(n)}},{key:"add",value:function(t,e){null==this.files[t]?(this.fileLength+=1,this.files[t]=this.validateFile(e)):this.systemError("add","Name conflict.",t)}},{key:"validateFile",value:function(t){var e=t.split(".").pop();return-1!==["png","jpg"].indexOf(e)||"data:"===t.slice(0,5)?t:_instanceof(t,Element)&&t.tagName("CANVAS")?canvas.toDataURL("image/png"):void this.systemError("validateFile","File type not allowed( png, jpg, canvas element, base64url ).",t)}},{key:"get",value:function(t){if(this.data[t])return this.data[t];this.systemError("get","Data not found.",t)}},{key:"close",value:function(t){t&&this.data[t]?(this.data[t].src="",this.data[t]=null):this.each(this.data,function(t){t.src="",t=null})}}]),i}(),n=function(){function t(){_classCallCheck(this,t)}return _createClass(t,null,[{key:"get",value:function(e){return t[e]&&"constructor"!==e&&"get"!==e?t[e]:t.linear}},{key:"linear",value:function(t,e){return t/e}},{key:"easeInQuad",value:function(t,e){return 1*(t/=e)*t}},{key:"easeOutQuad",value:function(t,e){return-1*(t/=e)*(t-2)}},{key:"easeInOutQuad",value:function(t,e){return(t/=e/2)<1?.5*t*t:-.5*(--t*(t-2)-1)}},{key:"easeInCubic",value:function(t,e){return 1*(t/=e)*t*t}},{key:"easeOutCubic",value:function(t,e){return 1*((t=t/e-1)*t*t+1)}},{key:"easeInOutCubic",value:function(t,e){return(t/=e/2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)}},{key:"easeInQuart",value:function(t,e){return 1*(t/=e)*t*t*t}},{key:"easeOutQuart",value:function(t,e){return-1*((t=t/e-1)*t*t*t-1)}},{key:"easeInOutQuart",value:function(t,e){return(t/=e/2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)}},{key:"easeInQuint",value:function(t,e){return 1*(t/=e)*t*t*t*t}},{key:"easeOutQuint",value:function(t,e){return 1*((t=t/e-1)*t*t*t*t+1)}},{key:"easeInOutQuint",value:function(t,e){return(t/=e/2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)}},{key:"easeInSine",value:function(t,e){return-1*Math.cos(t/e*(Math.PI/2))+1}},{key:"easeOutSine",value:function(t,e){return 1*Math.sin(t/e*(Math.PI/2))}},{key:"easeInOutSine",value:function(t,e){return-.5*(Math.cos(Math.PI*t/e)-1)}},{key:"easeInExpo",value:function(t,e){return 0==t?0:1*Math.pow(2,10*(t/e-1))}},{key:"easeOutExpo",value:function(t,e){return t==e?1:1*(1-Math.pow(2,-10*t/e))}},{key:"easeInOutExpo",value:function(t,e){return 0==t?0:t==e?1:(t/=e/2)<1?.5*Math.pow(2,10*(t-1)):.5*(2-Math.pow(2,-10*--t))}},{key:"easeInCirc",value:function(t,e){return-1*(Math.sqrt(1-(t/=e)*t)-1)}},{key:"easeOutCirc",value:function(t,e){return 1*Math.sqrt(1-(t=t/e-1)*t)}},{key:"easeInOutCirc",value:function(t,e){return(t/=e/2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)}},{key:"easeInElastic",value:function(t,e){var i=1.70158,n=0,a=1;if(0==t)return 0;if(1==(t/=e))return 1;if(n||(n=.3*e),a<1){a=1;i=n/4}else i=n/(2*Math.PI)*Math.asin(1/a);return-a*Math.pow(2,10*(t-=1))*Math.sin((t*e-i)*(2*Math.PI)/n)}},{key:"easeOutElastic",value:function(t,e){var i=1.70158,n=0,a=1;if(0==t)return 0;if(1==(t/=e))return 1;if(n||(n=.3*e),a<1){a=1;i=n/4}else i=n/(2*Math.PI)*Math.asin(1/a);return a*Math.pow(2,-10*t)*Math.sin((t*e-i)*(2*Math.PI)/n)+1}},{key:"easeInOutElastic",value:function(t,e){var i=1.70158,n=0,a=1;if(0==t)return 0;if(2==(t/=e/2))return 1;if(n||(n=e*(.3*1.5)),a<1){a=1;i=n/4}return t<1?a*Math.pow(2,10*(t-=1))*Math.sin((t*e-i)*(2*Math.PI)/n)*-.5:a*Math.pow(2,-10*(t-=1))*Math.sin((t*e-i)*(2*Math.PI)/n)*.5+1}},{key:"easeInBack",value:function(t,e){var i=1.70158;return 1*(t/=e)*t*((i+1)*t-i)}},{key:"easeOutBack",value:function(t,e){var i=1.70158;return 1*((t=t/e-1)*t*((i+1)*t+i)+1)}},{key:"easeInOutBack",value:function(t,e){var i=1.70158;return(t/=e/2)<1?t*t*((1+(i*=1.525))*t-i)*.5:.5*((t-=2)*t*((1+(i*=1.525))*t+i)+2)}},{key:"easeInBounce",value:function(t,e){return 1-this.easeOutBounce(e-t,e)}},{key:"easeOutBounce",value:function(t,e){return(t/=e)<1/2.75?7.5625*t*t*1:t<2/2.75?1*(7.5625*(t-=1.5/2.75)*t+.75):t<2.5/2.75?1*(7.5625*(t-=2.25/2.75)*t+.9375):1*(7.5625*(t-=2.625/2.75)*t+.984375)}},{key:"easeInOutBounce",value:function(t,e){return t<e/2?.5*this.easeInBounce(2*t,e):.5*this.easeOutBounce(2*t-e,e)+.5}}]),t}(),a=function(e){function i(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,a=arguments.length>2?arguments[2]:void 0,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"2d";return _classCallCheck(this,i),(t=_possibleConstructorReturn(this,_getPrototypeOf(i).call(this,"Bitmap"))).offscreenCanvasSupport="undefined"==typeof self?!!window.OffscreenCanvas:!!self.OffscreenCanvas,t.canvas=a||t.offscreenCanvasSupport?new OffscreenCanvas(e,n):document.createElement("canvas"),t.context=t.canvas.getContext(s),t.cache=!1,t.imgData=null,t.imgBitmap=null,t._width=t.canvas.width,t._height=t.canvas.height,null==a&&t.resize(e,n),t}return _inherits(i,t),_createClass(i,[{key:"getRenderTarget",value:function(){return this.imgBitmap&&!0===this.cache?this.imgBitmap:!1===this.cache?this.canvas:(this.cacheImageBitmap(),this.offscreenCanvasSupport?this.imgBitmap:this.canvas)}},{key:"resize",value:function(t,e){this.width=t||this.width,this.height=e||this.height}},{key:"clear",value:function(){this.context.clearRect(0,0,this.width,this.height)}},{key:"cacheImageBitmap",value:function(){var t=this;if(this.offscreenCanvasSupport)this.imgBitmap=this.canvas.transferToImageBitmap();else{var e=new Image;e.onload=function(){t.imgBitmap=e},e.src=this.canvas.toDataURL()}}},{key:"clearCache",value:function(){this.imgData=null,this.imgBitmap=null}},{key:"getPixel",value:function(t,e){var i=this.getImageData(),n=t*(4*i.width)+4*e;return[i.data[n],i.data[n+1],i.data[n+2],i.data[n+3]]}},{key:"getImageData",value:function(){return null==this.imgData&&(this.imgData=this.context.getImageData(0,0,this.width,this.height)),this.imgData}},{key:"putImageData",value:function(t){this.clear(),this.context.putImageData(t,0,0)}},{key:"width",get:function(){return this._width},set:function(t){this._width=t,this.canvas.width=t}},{key:"height",get:function(){return this._height},set:function(t){this._height=t,this.canvas.height=t}}],[{key:"isBitmap",value:function(t){return _instanceof(t,this)}}]),i}(),s=function(e){function i(t,e,n){var s;return _classCallCheck(this,i),(s=_possibleConstructorReturn(this,_getPrototypeOf(i).call(this,"Container"))).data=null,s.core=n||null,s.bitmap=new a(t,e),s.context=s.bitmap.context,s.stackOpacity=[],s.pointerX=0,s.pointerY=0,s.initStage(),s}return _inherits(i,t),_createClass(i,[{key:"initStage",value:function(){this.stage=new h("Stage"),this.stage.install(this),this.stage.resize(0,0),this.stage.render=function(){this.cache()}}},{key:"register",value:function(t){var e=this;this.core&&this.each(t.event,function(t){null==e.core.event[t.event]&&e.core.addEvent(t.event)})}},{key:"post",value:function(t){this.data=t,this.stageUpdate(),this.stageRender()}},{key:"stageUpdate",value:function(){this.stage.mainUpdate()}},{key:"stageRender",value:function(){this.stage.mainRender(),this.draw()}},{key:"getImageBitmap",value:function(t){if(this.bitmap.offscreenCanvasSupport){var e=this.bitmap.canvas.transferToImageBitmap();t(e),e.close()}else t(this.bitmap.canvas)}},{key:"addChildren",value:function(t){this.stage.addChildren(t)}},{key:"draw",value:function(){this.bitmap.clear(),this.render(this.stage)}},{key:"render",value:function(t){if(t.canShow){var e=Math.round(t.screenX),i=Math.round(t.screenY),n=t.getRealPosition();this.transform(t),n.x<this.width&&n.y<this.height&&this.context.drawImage(t.bitmap.getRenderTarget(),e,i);for(var a=t.children.length,s=0;s<a;s++)this.render(t.children[s]);this.restore(t)}}},{key:"transform",value:function(t){var e=this.context;if(1===t.scaleHeight&&1===t.scaleWidth||e.save(),255!==t.opacity&&(this.stackOpacity.push(t.opacity),e.globalAlpha=this.stackOpacity.reduce(function(t,e){return t+e})/(255*this.stackOpacity.length)),"source-over"!==t.blendMode&&(e.globalCompositeOperation=t.blendMode),!1!==t.isTransform()){var i=t.posX,n=t.posY;e.translate(i,n),1===t.scaleHeight&&1===t.scaleWidth||e.scale(t.scaleWidth,t.scaleHeight),0!==t.rotation&&e.rotate(t.rotation*t.helper.arc),0===t.skewX&&0===t.skewY||e.transform(1,t.skewX,t.skewY,1,0,0),e.translate(-i,-n)}}},{key:"restore",value:function(t){var e=this.context;if(1===t.scaleHeight&&1===t.scaleWidth){if(255!==t.opacity&&(this.stackOpacity.pop(),0===this.stackOpacity.length?e.globalAlpha=1:e.globalAlpha=this.stackOpacity.reduce(function(t,e){return t+e})/(255*this.stackOpacity.length)),"source-over"!==t.blendMode&&(e.globalCompositeOperation="source-over"),!1!==t.isTransform()){var i=t.posX,n=t.posY;e.translate(i,n),0!==t.rotation&&e.rotate(-t.rotation*t.helper.arc),0===t.skewX&&0===t.skewY||e.transform(1,-t.skewX,-t.skewY,1,0,0),e.translate(-i,-n)}}else e.restore()}},{key:"width",get:function(){return this.bitmap.canvas.width}},{key:"height",get:function(){return this.bitmap.canvas.height}}]),i}(),r=function(e){function i(t,e,n){var a;return _classCallCheck(this,i),(a=_possibleConstructorReturn(this,_getPrototypeOf(i).call(this,"Main"))).width=e,a.height=n,a.ticker=0,a.remove=!1,a.target="string"==typeof t?document.getElementById(t):t,a.context=a.target.getContext("2d"),a.baseFps=0,a.viewScale=1,a.framePerSecond=60,a.bindUpdate=a.update.bind(_assertThisInitialized(a)),a.targetRect=a.target.getBoundingClientRect(),a.container=new s(a.width,a.height,_assertThisInitialized(a)),window.requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)},a.initEvent(),a.initCamera(),a.update(),a}return _inherits(i,t),_createClass(i,[{key:"setFPS",value:function(t){"number"==typeof t&&t>0&&t<=60?this.framePerSecond=t:this.systemError("setFPS","FPS must between 1 to 60.",t)}},{key:"close",value:function(){this.remove=!0,this.target=null,this.container.stage.eachChildrenDeep(function(t){t.close()}),window.removeEventListener("resize",this.windowResize.bind(this))}},{key:"initCamera",value:function(){this.camera=new(function(){function t(e){_classCallCheck(this,t),this.x=0,this.y=0,this.core=e}return _createClass(t,[{key:"checkBorder",value:function(t,e,i){var n=i/2;return(t=t*this.core.viewScale)>n?t>e-n?e-i:(t-n)/this.core.viewScale:0}},{key:"offsetX",get:function(){return this.checkBorder(this.x,this.core.width*this.core.viewScale,this.core.targetRect.width)}},{key:"offsetY",get:function(){return this.checkBorder(this.y,this.core.height*this.core.viewScale,this.core.targetRect.height)}}]),t}())(this)}},{key:"setCamera",value:function(t,e){this.camera.x=t,this.camera.y=e}},{key:"initEvent",value:function(){this.event={},this.eventAction={},this.addEvent("click",this.resetPointerCoordinate),this.addEvent("pointermove",this.resetPointerCoordinate),this.windowResize(),window.addEventListener("resize",this.windowResize.bind(this))}},{key:"addEvent",value:function(t,e){var i=this;null==this.event[t]&&(this.event[t]=function(n){null==i.eventAction[t]&&(i.eventAction[t]=n,e&&e.bind(i)(n))},this.target.addEventListener(t,this.event[t]))}},{key:"resetPointerCoordinate",value:function(t){this.container.pointerX=(t.offsetX/this.viewScale+this.camera.offsetX)*(this.target.width/this.targetRect.width),this.container.pointerY=(t.offsetY/this.viewScale+this.camera.offsetY)*(this.target.height/this.targetRect.height)}},{key:"targetResize",value:function(t,e){this.target.width=t,this.target.height=e,this.targetRect=this.target.getBoundingClientRect()}},{key:"windowResize",value:function(){this.targetRect=this.target.getBoundingClientRect(),this.onWindowResize()}},{key:"onWindowResize",value:function(){}},{key:"forElementResize",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;this.targetResize(t.clientWidth,t.clientHeight),t.clientWidth/this.width<t.clientHeight/this.height?this.viewScale=t.clientHeight/this.height*e:this.viewScale=t.clientWidth/this.width*e,this.context.restore(),this.context.save(),this.context.scale(this.viewScale,this.viewScale)}},{key:"addChildren",value:function(t){this.container.addChildren(t)}},{key:"update",value:function(){if(1==this.remove)return window.cancelAnimationFrame(this.ticker),null;this.baseFps+=this.framePerSecond,this.stageUpdate(),this.baseFps>=60&&(this.bitmapUpdate(),this.baseFps=this.baseFps%60),this.eventAction={},this.ticker=window.requestAnimationFrame(this.bindUpdate)}},{key:"stageUpdate",value:function(){this.container.stage.mainEvent(this.eventAction),this.container.stageUpdate()}},{key:"bitmapUpdate",value:function(){this.container.stageRender(),this.context.clearRect(0,0,this.width,this.height),this.context.drawImage(this.container.bitmap.canvas,-this.camera.offsetX,-this.camera.offsetY)}}]),i}(),o=function(e){function i(t){var e;return _classCallCheck(this,i),(e=_possibleConstructorReturn(this,_getPrototypeOf(i).call(this,"Animate"))).validate({push:[t.push,60],time:[t.begin,0],duration:[t.duration,0],easing:[t.easing,"linear"],alternate:[t.alternate,!1],reverse:[t.reverse,!1],action:[t.action,function(){}]}),e.over=!1,e.actionEasing=n.get(e.easing),e.pace=1e3/e.push,e}return _inherits(i,t),_createClass(i,[{key:"validate",value:function(t){for(var e in t){var i=t[e][0],n=t[e][1];i?_typeof(i)===_typeof(n)?this[e]=i:this.systemError("validated","Type error",i):this[e]=n}}},{key:"move",value:function(){if(!1===this.over){var t=this.actionEasing(this.time+=this.reverse?-this.pace:this.pace,this.duration);return this.action(t),this.alternate?this.time>=this.duration?this.reverse=!0:this.reverse&&this.time<=0&&(this.reverse=!1):this.time>=this.duration&&(this.over=!0),t}return 1}},{key:"restart",value:function(){this.time=0,this.over=!1}}]),i}(),h=function(i){function n(t){var i;return _classCallCheck(this,n),(i=_possibleConstructorReturn(this,_getPrototypeOf(n).call(this,t||"Sprite"))).name=t||"No name",i.main=null,i.helper=e,i.bindUpdateForChild=i.updateForChild.bind(_assertThisInitialized(i)),i.initEvent(),i.initRender(),i.initStatus(),i.initBitmap(),i.initFamily(),i.initPosition(),i.initTransform(),i}return _inherits(n,t),_createClass(n,[{key:"eachChildren",value:function(t){for(var e=this.children.length,i=0;i<e;i++)t(this.children[i])}},{key:"eachChildrenDeep",value:function(t){!function e(i){i.eachChildren(function(i){t(i),e(i)})}(this)}},{key:"super",value:function(t){var e;this.__proto__[t]?(e=this.__proto__[t]).call.apply(e,[this].concat(_toConsumableArray(Array.prototype.slice.call(arguments).slice(1)))):this.systemError("super","Prototype not found.",t)}},{key:"install",value:function(t){this.main=t,this.main.register(this),this.create()}},{key:"create",value:function(){}},{key:"initBitmap",value:function(){var t=this.parent||{};this.bitmap=new a(t.width||100,t.height||100),this.context=this.bitmap.context}},{key:"resize",value:function(t,e){"object"===_typeof(t)?t.width&&t.height?this.bitmap.resize(t.width,t.height):this.systemError("resize","Object must have width and height.",t):this.bitmap.resize(t,e)}},{key:"initFamily",value:function(){this.parent=null,this.children=[]}},{key:"addChildren",value:function(t){n.isSprite(t)?null==t.parent?(t.parent=this,this.children.push(t),this.sortChildren()):this.systemError("addChildren","Sprite have parent.",t):this.systemError("addChildren","Object not a sprite",t)}},{key:"sortChildren",value:function(){var t=[],e=[];this.eachChildren(function(t){null==e[t.z]&&(e[t.z]=[]),e[t.z].push(t)}),this.each(e,function(e){Array.isArray(e)&&(t=t.concat(e))}),this.children=t}},{key:"initEvent",value:function(){this.event={}}},{key:"on",value:function(t,e,i){null==this.event[t]?(this.main.core&&this.main.core.addEvent(e),this.event[t]={event:e,callback:i}):this.systemError("on","Event name(".concat(t,") conflict."))}},{key:"unon",value:function(t){this.event[t]=null}},{key:"mainEvent",value:function(t){var e=this;null==this.main&&this.install(this.parent.main),this.each(t,function(t,i){e.each(e.event,function(e){e.event===i&&e.callback(t)})}),this.eachChildren(function(e){e.mainEvent(t)})}},{key:"initTransform",value:function(){this.transform={skewX:0,skewY:0,scaleWidth:1,scaleHeight:1,rotation:0,opacity:255,blendMode:"source-over"}}},{key:"isTransform",value:function(){var t=this.transform;return!(0===t.skewX&&0===t.skewY&&1===t.scaleWidth&&1===t.scaleHeight&&0===t.rotation)}},{key:"scale",value:function(t,e){this.scaleWidth=t,this.scaleHeight=e||t}},{key:"initPosition",value:function(){this.position={x:0,y:0,z:0,screenX:0,screenY:0,anchorX:0,anchorY:0}}},{key:"setAnchor",value:function(t,e){this.anchorX=t,this.anchorY=e||t}},{key:"initStatus",value:function(){this.status={sort:!1,cache:!1,remove:!1,hidden:!1,realSize:null,childrenDead:!1}}},{key:"cache",value:function(){this.status.cache=!0,this.bitmap.cache=!0}},{key:"unCache",value:function(){this.status.cache=!1,this.bitmap.cache=!1}},{key:"hidden",value:function(t){this.status.hidden=!t||!!t}},{key:"unHidden",value:function(){this.status.hidden=!1}},{key:"getRealSize",value:function(){if(null==this.status.realSize){var t=this.width+this.skewY*this.height,e=this.height+this.skewX*this.width,i=Math.abs(this.helper.sinByRad(this.rotation)),n=Math.abs(this.helper.cosByRad(this.rotation));this.status.realSize={width:(t*n+e*i)*this.screenScaleWidth,height:(e*n+t*i)*this.screenScaleHeight}}return this.status.realSize}},{key:"getRealPosition",value:function(){return{x:this.screenX*(null==this.parent?1:this.parent.screenScaleWidth),y:this.screenY*(null==this.parent?1:this.parent.screenScaleHeight)}}},{key:"update",value:function(){}},{key:"mainUpdate",value:function(){null==this.main&&this.install(this.parent.main),this.position.screenX=null,this.position.screenY=null,this.status.realSize=null,this.status.sort&&(this.status.sort=!1,this.sortChildren()),this.update(),this.eachChildren(this.bindUpdateForChild),this.status.childrenDead&&(this.status.childrenDead=!1,this.children=this.children.filter(function(t){return t.status.remove&&t.close(),!t.status.remove}))}},{key:"updateForChild",value:function(t){0==t.status.remove?t.mainUpdate():this.status.childrenDead=!0}},{key:"close",value:function(){this.id=-1,this.parent=null}},{key:"remove",value:function(){this.status.remove=!0}},{key:"removeChild",value:function(t){n.isSprite(t)?t.parent===this?t.remove():this.systemError("removeChild","Have'n this sprite",t):this.systemError("removeChild","Not a sprite",t)}},{key:"clearChildren",value:function(){var t=this;this.eachChildren(function(e){t.removeChild(e)})}},{key:"removeChildrenByName",value:function(t){var e=this;this.eachChildren(function(i){i.name===t&&e.removeChild(i)})}},{key:"removeChildrenByIndex",value:function(t){"number"==typeof t&&this.children[t]&&this.children[t].remove()}},{key:"initRender",value:function(){this.filter}},{key:"render",value:function(){}},{key:"mainRender",value:function(){this.eachChildren(this.renderForChild),this.canRender&&(this.context.save(),this.render(),this.context.restore(),this.renderFilter(this.filter),this.context.restore(),this.bitmap.clearCache())}},{key:"renderForChild",value:function(t){t.mainRender()}},{key:"fromImage",value:function(t){return this.resize(t),this.render=function(){this.context.drawImage(t,0,0),this.cache()},this}},{key:"renderFilter",value:function(t){if(t){var e=this.bitmap.getImageData();t.call(this,e),this.bitmap.putImageData(e),this.eachChildren(function(e){e.renderFilter(t)})}}},{key:"eachImgData",value:function(t,e){for(var i=t.data,n=0,a=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:255;i[n]=t.red||t,i[n+1]=t.green||e,i[n+2]=t.blue||a,i[n+3]=t.alpha||s},s=0;s<i.length;s+=4){n=s,e({red:i[s],green:i[s+1],blue:i[s+2],alpha:i[s+3]},a)}}},{key:"inRect",value:function(t,e){var i=this.getRealSize(),n=this.getRealPosition();return t>=n.x&&t<=n.x+i.width&&e>=n.y&&e<=n.y+i.height}},{key:"width",get:function(){return this.bitmap.width},set:function(t){this.bitmap.width=t}},{key:"height",get:function(){return this.bitmap.height},set:function(t){this.bitmap.height=t}},{key:"scaleWidth",get:function(){return this.transform.scaleWidth},set:function(t){this.transform.scaleWidth=t}},{key:"scaleHeight",get:function(){return this.transform.scaleHeight},set:function(t){this.transform.scaleHeight=t}},{key:"screenScaleWidth",get:function(){return null==this.parent?this.scaleWidth:this.scaleWidth*this.parent.screenScaleWidth}},{key:"screenScaleHeight",get:function(){return null==this.parent?this.scaleHeight:this.scaleHeight*this.parent.screenScaleHeight}},{key:"rotation",get:function(){return this.transform.rotation},set:function(t){this.transform.rotation=t%360}},{key:"blendMode",get:function(){return this.transform.blendMode},set:function(t){this.transform.blendMode=t}},{key:"opacity",get:function(){return this.transform.opacity},set:function(t){t<=0&&(t=0),t>=255&&(t=255),this.transform.opacity=t}},{key:"skewX",get:function(){return this.transform.skewX},set:function(t){this.transform.skewX=t}},{key:"skewY",get:function(){return this.transform.skewY},set:function(t){this.transform.skewY=t}},{key:"x",get:function(){return this.position.x},set:function(t){"number"==typeof t&&(this.position.x=t||0)}},{key:"y",get:function(){return this.position.y},set:function(t){"number"==typeof t&&(this.position.y=t||0)}},{key:"z",get:function(){return this.position.z},set:function(t){"number"==typeof t&&(this.position.z=t,this.parent&&(this.parent.status.sort=!0))}},{key:"screenX",get:function(){return null==this.position.screenX&&(this.position.screenX=(this.parent?this.parent.screenX+this.parent.width*this.parent.anchorX:0)+this.x-this.width*this.anchorX),this.position.screenX}},{key:"screenY",get:function(){return null==this.position.screenY&&(this.position.screenY=(this.parent?this.parent.screenY+this.parent.height*this.parent.anchorY:0)+this.y-this.height*this.anchorY),this.position.screenY}},{key:"posX",get:function(){return this.screenX+this.width*this.anchorX}},{key:"posY",get:function(){return this.screenY+this.height*this.anchorY}},{key:"anchorX",get:function(){return this.position.anchorX},set:function(t){this.position.anchorX=t}},{key:"anchorY",get:function(){return this.position.anchorY},set:function(t){this.position.anchorY=t}},{key:"canRender",get:function(){return!this.status.cache}},{key:"canShow",get:function(){return!this.status.hidden}}],[{key:"isSprite",value:function(t){return _instanceof(t,this)}}]),n}(),c=r;return c.Sprite=h,c.Bitmap=a,c.Loader=i,c.Helper=e,c.Animate=o,c.Container=s,c});